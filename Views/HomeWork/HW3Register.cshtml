
@{
    ViewData["Title"] = "HW3Register";
}

<h1>作業三 檢查帳號是否存在</h1>
<div>
    <ul>
        <li>在Register.cshtml中，使用者輸入姓名離開後，透過Ajax技術將姓名送到api/CheckAccount</li>
        <li>在 CheckAccount Action 中檢查帳號是否存在，將檢查結果回傳給Client端顯示</li>
    </ul>
</div>

<div class="row">
    <div class="col-3"></div>
    <div class="col-6">
        @* <form action="~/api/getdemo" method="post">*@
        <form id="form1">
            <div class="mb-3">
                <label for="username" class="form-label">User Name：</label>
                <input type="text" class="form-control" id="username" name="Name">
                <div class="alert alert-danger" id="checkingaccount"></div>
            </div>
            
            <div class="mb-3">
                <label for="useremail" class="form-label">User Email：</label>
                <input type="text" class="form-control" id="useremail" name="Email">
            </div>
            <div class="mb-3">
                <label for="userage" class="form-label">User Age：</label>
                <input type="number" class="form-control" id="userage" name="Age">
            </div>
            <div class="mb-3">
                <label for="formFile" class="form-label">Photo：</label>
                <input type="file" class="form-control" id="formFile" name="file">
            </div>

            <button id="btn1" type="submit" class="btn btn-success">送出</button>
        </form>
        <div class="alert alert-info" id="div1"></div>
    </div>
</div>

@section Scripts{
    <script>
        const btn = document.querySelector('#btn1');
        const theA = document.querySelector('#a1');
        const txtName = document.querySelector("#username");
        //const txtAge = document.querySelector("#userage");
        const theDiv = document.querySelector('#div1');
        const YesName = document.querySelector('#checkingaccount')


        
       

            //用ajax去連
            const xhr = new XMLHttpRequest();

            txtName.addEventListener('blur',=>{
            const account = txtName.value;

            xhr.open('GET', '/api/checkaccount?name=${account}');

            xhr.send();
        })
            xhr.addEventListener('load', () => {
                const data = xhr.responseText;
                if(data!=null){
                YesName.innerHTML = "帳號已存在";
                }
                else{
                    YesName.innerHTML="帳號不存在"
                }
            })
        

       

    </script>
}
